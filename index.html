<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor Económico Integral - Zona Sur</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; background: #f1f5f9; color: #1e293b; }
        
        /* Contenedores Gráficos */
        .card { background: white; border-radius: 0.75rem; padding: 1.25rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        .chart-box { position: relative; height: 250px; width: 100%; overflow: hidden; }
        
        /* Mapa y Leyenda */
        .map-container { height: 500px; width: 100%; border-radius: 0.5rem; z-index: 1; }
        .legend {
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 12px;
            border-radius: 6px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            font-size: 11px;
            line-height: 1.4;
            max-height: 350px;
            overflow-y: auto;
            border: 1px solid #cbd5e1;
        }
        .legend i { width: 10px; height: 10px; float: left; margin-right: 8px; opacity: 0.9; border-radius: 50%; margin-top: 3px; }
        
        /* Scrollbar fino */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    </style>
</head>
<body class="p-3 md:p-6 lg:p-8">

    <div class="max-w-7xl mx-auto space-y-6">
        
        <header class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-indigo-600 flex flex-col md:flex-row justify-between items-center">
            <div class="mb-4 md:mb-0">
                <h1 class="text-2xl font-bold text-slate-800">Monitor Económico Integral</h1>
                <p class="text-sm text-slate-500">Zona Sur-Oriente: La Misión, Los Pájaros, 6 de Junio</p>
            </div>
            <div class="text-right">
                <div class="text-xs font-bold text-indigo-600 uppercase tracking-widest">Unidades Activas</div>
                <div class="text-3xl font-bold text-slate-900">1,683</div>
            </div>
        </header>

        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="card border-t-4 border-indigo-500">
                <div class="text-xs text-slate-400 font-bold uppercase">Colonia Top</div>
                <div class="text-lg font-bold truncate">LA MISIÓN</div>
                <div class="text-indigo-600 text-xs font-semibold">291 negocios</div>
            </div>
            <div class="card border-t-4 border-emerald-500">
                <div class="text-xs text-slate-400 font-bold uppercase">Tamaño Dominante</div>
                <div class="text-lg font-bold">Micro (0-5)</div>
                <div class="text-emerald-600 text-xs font-semibold">91.7% del total</div>
            </div>
            <div class="card border-t-4 border-amber-500">
                <div class="text-xs text-slate-400 font-bold uppercase">Giro Principal</div>
                <div class="text-lg font-bold">Abarrotes</div>
                <div class="text-amber-600 text-xs font-semibold">26% del mercado</div>
            </div>
            <div class="card border-t-4 border-blue-500">
                <div class="text-xs text-slate-400 font-bold uppercase">Pico Registro</div>
                <div class="text-lg font-bold">2024</div>
                <div class="text-blue-600 text-xs font-semibold">785 altas</div>
            </div>
        </div>

        <div class="card ring-1 ring-slate-200">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-bold text-slate-700 flex items-center">
                    <svg class="w-5 h-5 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    Distribución Geoespacial: Top 10 Actividades
                </h2>
                <span class="bg-indigo-50 text-indigo-700 text-xs px-2 py-1 rounded font-semibold border border-indigo-100">Mapa Interactivo</span>
            </div>
            <div id="map" class="map-container"></div>
            <p class="text-xs text-slate-400 mt-2 text-center">Mostrando muestra representativa de puntos categorizados por color.</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="card">
                <h3 class="font-bold text-slate-700 mb-4">Top 5 Colonias Comerciales</h3>
                <div class="chart-box">
                    <canvas id="coloniasChart"></canvas>
                </div>
            </div>
            <div class="card">
                <h3 class="font-bold text-slate-700 mb-4">Distribución por Sector</h3>
                <div class="chart-box">
                    <canvas id="sectorChart"></canvas>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="card lg:col-span-2">
                <h3 class="font-bold text-slate-700 mb-4">Top 10 Actividades (Detalle)</h3>
                <div class="chart-box">
                    <canvas id="activitiesChart"></canvas>
                </div>
            </div>
            <div class="card">
                <h3 class="font-bold text-slate-700 mb-4">Tamaño de Empresa</h3>
                <div class="chart-box">
                    <canvas id="sizeChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <h3 class="font-bold text-slate-700 mb-4">Evolución de Registros (Año de Alta)</h3>
            <div class="chart-box">
                <canvas id="yearChart"></canvas>
            </div>
        </div>

        <footer class="text-center text-xs text-slate-400 mt-8 pb-4">
            Generado con Inteligencia Artificial | Fuente: INEGI DENUE
        </footer>

    </div>

    <script>
        // --- 1. DATOS UNIFICADOS ---
        const stats = {
            colonias: {"LA MISION": 291, "LOS PAJAROS": 245, "6 DE JUNIO": 160, "RIVERA CERRO HUECO": 140, "AZTECA": 107},
            sectores: {"Comercio Minorista": 791, "Servicios": 305, "Alimentos/Bebidas": 215, "Manufacturas": 46, "Otros": 326},
            tamano: {"0-5 personas": 1544, "6-10 personas": 84, "11-30 personas": 40, "31+": 15},
            historico: {"2010": 267, "2014": 205, "2019": 377, "2023": 10, "2024": 785},
            // Nombres cortos para gráficas
            actividadesLabels: ["Abarrotes", "Belleza", "Religiosas", "Comida Rápida", "Pollerías", "Mecánica", "Tacos/Tortas", "Tortillerías", "Antojitos", "Papelerías"],
            actividadesData: [439, 76, 72, 48, 46, 42, 37, 37, 36, 35]
        };

        // --- 2. CONFIGURACIÓN DEL MAPA ---
        const map = L.map('map', { scrollWheelZoom: false }).setView([16.733, -93.075], 14);
        
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '© OpenStreetMap'
        }).addTo(map);

        // Paleta de Colores (Top 10)
        const palette = {
            "Comercio al por menor en tiendas de abarrotes, ultramarinos y misceláneas": "#ef4444", // Rojo
            "Salones y clínicas de belleza y peluquerías": "#ec4899", // Rosa
            "Asociaciones y organizaciones religiosas": "#8b5cf6", // Violeta
            "Restaurantes con servicio de preparación de pizzas, hamburguesas, hot dogs y pollos rostizados para llevar": "#f97316", // Naranja
            "Comercio al por menor de carne de aves": "#eab308", // Amarillo
            "Reparación mecánica en general de automóviles y camiones": "#3b82f6", // Azul
            "Restaurantes con servicio de preparación de tacos y tortas": "#f59e0b", // Ambar
            "Elaboración de tortillas de maíz y molienda de nixtamal": "#84cc16", // Lima
            "Restaurantes con servicio de preparación de antojitos": "#10b981", // Esmeralda
            "Comercio al por menor de artículos de papelería": "#06b6d4" // Cian
        };

        // Etiquetas cortas para leyenda
        const shortNames = {
            "Comercio al por menor en tiendas de abarrotes, ultramarinos y misceláneas": "Abarrotes",
            "Salones y clínicas de belleza y peluquerías": "Belleza / Peluquerías",
            "Asociaciones y organizaciones religiosas": "Religiosas",
            "Restaurantes con servicio de preparación de pizzas, hamburguesas, hot dogs y pollos rostizados para llevar": "Comida Rápida (Pollos/Pizzas)",
            "Comercio al por menor de carne de aves": "Pollerías (Crudo)",
            "Reparación mecánica en general de automóviles y camiones": "Mecánica Automotriz",
            "Restaurantes con servicio de preparación de tacos y tortas": "Tacos y Tortas",
            "Elaboración de tortillas de maíz y molienda de nixtamal": "Tortillerías",
            "Restaurantes con servicio de preparación de antojitos": "Antojitos",
            "Comercio al por menor de artículos de papelería": "Papelerías"
        };

        // Muestra de Puntos (Integrados directamente para rendimiento)
        const mapPoints = [
            {lat: 16.7341, lng: -93.0804, name: "ABARROTES SIN NOMBRE", type: "Comercio al por menor en tiendas de abarrotes, ultramarinos y misceláneas"},
            {lat: 16.7343, lng: -93.0810, name: "ABARROTES GABY", type: "Comercio al por menor en tiendas de abarrotes, ultramarinos y misceláneas"},
            {lat: 16.7321, lng: -93.0917, name: "ABARROTES ZEUS", type: "Comercio al por menor en tiendas de abarrotes, ultramarinos y misceláneas"},
            {lat: 16.7293, lng: -93.0752, name: "ABARROTES SIN NOMBRE", type: "Comercio al por menor en tiendas de abarrotes, ultramarinos y misceláneas"},
            {lat: 16.7298, lng: -93.0735, name: "ABARROTES LOHER", type: "Comercio al por menor en tiendas de abarrotes, ultramarinos y misceláneas"},
            {lat: 16.7325, lng: -93.0723, name: "BARBER SHOP", type: "Salones y clínicas de belleza y peluquerías"},
            {lat: 16.7381, lng: -93.0702, name: "ESTETICA LUNA AZUL", type: "Salones y clínicas de belleza y peluquerías"},
            {lat: 16.7330, lng: -93.0901, name: "BARBERIA CABALLERO", type: "Salones y clínicas de belleza y peluquerías"},
            {lat: 16.7337, lng: -93.0821, name: "CAPILLA JUSTO JUEZ", type: "Asociaciones y organizaciones religiosas"},
            {lat: 16.7322, lng: -93.0742, name: "TEMPLO ADVENTISTA", type: "Asociaciones y organizaciones religiosas"},
            {lat: 16.7263, lng: -93.0683, name: "FUENTE DE FE", type: "Asociaciones y organizaciones religiosas"},
            {lat: 16.7304, lng: -93.0826, name: "VIGI BURGES", type: "Restaurantes con servicio de preparación de pizzas, hamburguesas, hot dogs y pollos rostizados para llevar"},
            {lat: 16.7335, lng: -93.0766, name: "POLLO ASADO LA GUERA", type: "Restaurantes con servicio de preparación de pizzas, hamburguesas, hot dogs y pollos rostizados para llevar"},
            {lat: 16.7375, lng: -93.0629, name: "POLLOS XIK", type: "Restaurantes con servicio de preparación de pizzas, hamburguesas, hot dogs y pollos rostizados para llevar"},
            {lat: 16.7367, lng: -93.0650, name: "TORTILLERIA EL POZOL", type: "Elaboración de tortillas de maíz y molienda de nixtamal"},
            {lat: 16.7322, lng: -93.0673, name: "TORTILLERIA ABRIL", type: "Elaboración de tortillas de maíz y molienda de nixtamal"},
            {lat: 16.7374, lng: -93.0767, name: "TORTILLERIA 2001", type: "Elaboración de tortillas de maíz y molienda de nixtamal"},
            {lat: 16.7289, lng: -93.0924, name: "TALLER MECANICO", type: "Reparación mecánica en general de automóviles y camiones"},
            {lat: 16.7350, lng: -93.0850, name: "SERVICIO AUTOMOTRIZ", type: "Reparación mecánica en general de automóviles y camiones"},
            {lat: 16.7331, lng: -93.0757, name: "PAPELERIA DANIELA", type: "Comercio al por menor de artículos de papelería"},
            {lat: 16.7321, lng: -93.0949, name: "PAPELERIA SANTOS", type: "Comercio al por menor de artículos de papelería"},
            {lat: 16.7342, lng: -93.0801, name: "CARNICERIA KICHAN", type: "Comercio al por menor de carnes rojas"}, // Ejemplo extra
             {lat: 16.7346, lng: -93.0882, name: "VENTA DE AMBURGUESA", type: "Restaurantes con servicio de preparación de pizzas, hamburguesas, hot dogs y pollos rostizados para llevar"}
        ];

        // Añadir puntos al mapa
        mapPoints.forEach(p => {
            const color = palette[p.type] || '#94a3b8';
            L.circleMarker([p.lat, p.lng], {
                radius: 7, fillColor: color, color: "#fff", weight: 1.5, opacity: 1, fillOpacity: 0.8
            }).bindPopup(`<div class="font-sans text-center"><strong class="block text-slate-800 text-sm">${p.name}</strong><span class="text-xs px-2 py-0.5 rounded text-white mt-1 inline-block" style="background:${color}">${shortNames[p.type] || 'Otro'}</span></div>`).addTo(map);
        });

        // Leyenda
        const legend = L.control({position: 'bottomright'});
        legend.onAdd = function (map) {
            const div = L.DomUtil.create('div', 'legend');
            div.innerHTML = '<strong class="block mb-2 text-slate-700">Top 10 Actividades</strong>';
            for (const [key, value] of Object.entries(palette)) {
                div.innerHTML += `<div class="flex items-center mb-1"><i style="background:${value}"></i><span class="text-slate-600">${shortNames[key]}</span></div>`;
            }
            return div;
        };
        legend.addTo(map);

        // --- 3. CONFIGURACIÓN DE GRÁFICAS ---
        Chart.defaults.font.family = "system-ui";
        Chart.defaults.maintainAspectRatio = false;
        Chart.defaults.color = '#64748b';

        // Gráfica Colonias (Barras)
        new Chart(document.getElementById('coloniasChart'), {
            type: 'bar',
            data: {
                labels: Object.keys(stats.colonias),
                datasets: [{
                    label: 'Negocios', data: Object.values(stats.colonias),
                    backgroundColor: ['#4f46e5', '#6366f1', '#818cf8', '#a5b4fc', '#c7d2fe'], borderRadius: 4
                }]
            },
            options: { indexAxis: 'y', plugins: { legend: { display: false } } }
        });

        // Gráfica Sectores (Dona)
        new Chart(document.getElementById('sectorChart'), {
            type: 'doughnut',
            data: {
                labels: Object.keys(stats.sectores),
                datasets: [{
                    data: Object.values(stats.sectores),
                    backgroundColor: ['#f43f5e', '#3b82f6', '#10b981', '#f59e0b', '#94a3b8'], borderWidth: 0
                }]
            },
            options: { cutout: '65%', plugins: { legend: { position: 'right', labels: { boxWidth: 10 } } } }
        });

        // Gráfica Actividades Top 10 (Barras Horizontales con colores del mapa)
        new Chart(document.getElementById('activitiesChart'), {
            type: 'bar',
            data: {
                labels: stats.actividadesLabels,
                datasets: [{
                    label: 'Cantidad', data: stats.actividadesData,
                    backgroundColor: Object.values(palette), borderRadius: 4
                }]
            },
            options: { 
                plugins: { legend: { display: false } },
                scales: { x: { grid: { display: false } } }
            }
        });

        // Gráfica Tamaño (Pie)
        new Chart(document.getElementById('sizeChart'), {
            type: 'pie',
            data: {
                labels: Object.keys(stats.tamano),
                datasets: [{
                    data: Object.values(stats.tamano),
                    backgroundColor: ['#10b981', '#34d399', '#6ee7b7', '#a7f3d0'], borderWidth: 0
                }]
            },
            options: { plugins: { legend: { position: 'bottom', labels: { boxWidth: 10 } } } }
        });

        // Gráfica Histórico (Línea)
        new Chart(document.getElementById('yearChart'), {
            type: 'line',
            data: {
                labels: Object.keys(stats.historico),
                datasets: [{
                    label: 'Nuevos Registros', data: Object.values(stats.historico),
                    borderColor: '#f59e0b', backgroundColor: 'rgba(245, 158, 11, 0.1)',
                    fill: true, tension: 0.4, pointRadius: 4
                }]
            },
            options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
        });

        // Ajuste final
        setTimeout(() => map.invalidateSize(), 500);

    </script>
</body>
</html>